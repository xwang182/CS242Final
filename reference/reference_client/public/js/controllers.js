var mp4Controllers=angular.module("mp4Controllers",[]);mp4Controllers.controller("UsersController",["$scope","UserData",function($scope,UserData){$scope.users=[];var setUsers=function(response){"OK"===response.message?$scope.users=response.data:alert(response.message)};UserData.getUsers().then(setUsers);var refresh=function(response){"OK"===response.message?UserData.getUsers().then(setUsers):alert(response.message)};$scope.deleteUser=function(userId){UserData.deleteUser(userId).then(refresh)}}]),mp4Controllers.controller("AddUserController",["$scope","UserData",function($scope,UserData){$scope.name="",$scope.email="";var showSubmit=function(response){"OK"===response.message?($("#message").html("User has successfully added"),$scope.name="",$scope.email=""):($("#message").html(response.message),$scope.email="")};$scope.submit=function(){if(""===$scope.name||""===$scope.email)return void alert("User name or email can not be empty");var userData={name:$scope.name,email:$scope.email};UserData.addUser(userData).then(showSubmit)}}]),mp4Controllers.controller("OneUserController",["$scope","$routeParams","UserData","TaskData",function($scope,$routeParams,UserData,TaskData){$scope.userId=$routeParams.userId,$scope.user={},$scope.tasks=[],$scope.completeTasks=[];var inHeight=$(".inButton").height();$("#outDiv").height(inHeight);var setTask=function(response){"OK"===response.message?$scope.tasks.push(response.data):alert(response.message)},setUser=function(response){if("OK"===response.message){$scope.user=response.data;for(var taskList=$scope.user.pendingTasks,Index=0;Index<taskList.length;Index++)TaskData.getOneTask(taskList[Index]).then(setTask)}else alert(response.message)};UserData.getOneUser($scope.userId).then(setUser);var refresh=function(response){"OK"===response.message?($scope.tasks=[],$scope.completeTasks=[],UserData.getOneUser($scope.userId).then(setUser)):alert(response.message)};$scope.complete=function(taskId,index){var task=$scope.tasks[index],taskName=task.name,taskDescription=task.description,taskDeadline=task.deadline,taskCompleted=!0,taskAssignedUser=task.assignedUser,taskAssignedUserName=task.assignedUserName,taskData={name:taskName,description:taskDescription,deadline:taskDeadline,completed:taskCompleted,assignedUser:taskAssignedUser,assignedUserName:taskAssignedUserName};TaskData.changeTask(taskId,taskData).then(refresh)};var setCompleteTask=function(response){"OK"===response.message?$scope.completeTasks=response.data:alert(response.message)};$scope.loadCompleteTask=function(){0===$scope.completeTasks.length?TaskData.getUserTasks($scope.userId).then(setCompleteTask):$scope.completeTasks=[]}}]),mp4Controllers.controller("TasksController",["$scope","TaskData",function($scope,TaskData){$scope.tasks=[],$scope.taskType="pending",$scope.everyPage=10,$scope.pageNum=0,$scope.sortByValue="",$scope.sortByOrder="";var setTasks=function(response){"OK"===response.message?($scope.tasks=response.data,0===$scope.tasks.length&&$scope.pageNum>0&&($scope.pageNum=$scope.pageNum-1,alert("This is the last page, can not go to next page anymore"))):alert(response.message)};$scope.getTask=function(){TaskData.getTasks($scope.pageNum,$scope.everyPage,$scope.taskType,$scope.sortByValue,$scope.sortByOrder).then(setTasks)},$scope.getTask(),$scope.prevPage=function(){$scope.pageNum>0?$scope.pageNum=$scope.pageNum-1:alert("This is the first page, can not go to previous page anymore")},$scope.nextPage=function(){$scope.tasks.length===$scope.everyPage?$scope.pageNum=$scope.pageNum+1:alert("This is the last page, can not go to next page anymore")},$scope.changeType=function(){$scope.pageNum=0,TaskData.getTasks($scope.pageNum,$scope.everyPage,$scope.taskType,$scope.sortByValue,$scope.sortByOrder).then(setTasks)},$scope.$watch("pageNum",$scope.getTask,!0),$scope.$watch("taskType",$scope.changeType,!0),$scope.$watch("sortByValue",$scope.changeType,!0),$scope.$watch("sortByOrder",$scope.changeType,!0),$scope.deleteTask=function(taskId){TaskData.deleteTask(taskId).then($scope.getTask)}}]),mp4Controllers.controller("AddTaskController",["$scope","TaskData","UserData",function($scope,TaskData,UserData){$scope.name="",$scope.description="",$scope.deadline="",$scope.completed=!1,$scope.AssignUser={},$scope.users=[];var setUsers=function(response){"OK"===response.message?$scope.users=response.data:alert(response.message)};UserData.getUsers().then(setUsers);var showSubmit=function(response){"OK"===response.message?($scope.name="",$scope.description="",$scope.deadline="",$scope.completed=!1,$scope.AssignUser={},$("#message").html("Task has successfully added")):alert(response.message)};$scope.submit=function(){if(""===$scope.name||""===$scope.deadline)return void alert("Task name of deadline can not be empty");var deadlineDate=new Date($scope.deadline).toISOString(),taskData={name:$scope.name,description:$scope.description,deadline:deadlineDate,completed:$scope.completed,assignedUser:$scope.AssignUser._id,assignedUserName:$scope.AssignUser.name};TaskData.addTask(taskData).then(showSubmit)}}]),mp4Controllers.controller("OneTaskController",["$scope","$routeParams","TaskData",function($scope,$routeParams,TaskData){$scope.taskId=$routeParams.taskId,$scope.task={};var setTask=function(response){"OK"===response.message?($scope.task=response.data,"unassigned"===$scope.task.assignedUser&&$("#userPage").hide()):alert(response.message)};TaskData.getOneTask($scope.taskId).then(setTask);var reverse=function(response){"OK"===response.message?$scope.task.completed=!$scope.task.completed:alert(response.message)};$scope.completionChange=function(){var taskCompleted=!$scope.task.completed,taskData={name:$scope.task.name,description:$scope.task.description,deadline:$scope.task.deadline,completed:taskCompleted,assignedUser:$scope.task.assignedUser,assignedUserName:$scope.task.assignedUserName};TaskData.changeTask($scope.taskId,taskData).then(reverse)}}]),mp4Controllers.controller("EditTaskController",["$scope","$routeParams","TaskData","UserData",function($scope,$routeParams,TaskData,UserData){$scope.taskId=$routeParams.taskId,$scope.task={},$scope.AssignUser={},$scope.users=[];var setUsers=function(response){if("OK"===response.message){$scope.users=response.data;for(var index=0;index<$scope.users.length;index++)if(response.data[index]._id===$scope.task.assignedUser){$scope.AssignUser=response.data[index];break}}else alert(response.message)},setTask=function(response){if("OK"===response.message){$scope.task=response.data,$scope.deadline=$scope.task.deadline;var date=new Date($scope.deadline);$scope.deadline=date.toString(),UserData.getUsers().then(setUsers)}else alert(response.message)};TaskData.getOneTask($scope.taskId).then(setTask);var refresh=function(response){"OK"===response.message?$("#message").html("Task has successfully edited"):alert(response.message)};$scope.edit=function(){if(""===$scope.task.name||""===$scope.deadline)return void alert("Task name of deadline can not be empty");var deadlineDate=new Date($scope.deadline).toISOString(),taskData={name:$scope.task.name,description:$scope.task.description,deadline:deadlineDate,completed:$scope.task.completed,assignedUser:$scope.AssignUser._id,assignedUserName:$scope.AssignUser.name};TaskData.changeTask($scope.taskId,taskData).then(refresh)}}]),mp4Controllers.controller("SettingsController",["$scope","UserData","TaskData",function($scope,UserData,TaskData){$scope.url=UserData.getURL(),$scope.setUrl=function(){UserData.setting($scope.url),TaskData.setting($scope.url),$scope.displayText="URL is set"}}]);